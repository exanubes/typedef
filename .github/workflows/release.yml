name: Release

on:
  push:
    tags:
      - 'v*'  # Trigger on version tags like v1.0.0
  workflow_dispatch:  # Allow manual trigger

jobs:
  test:
    uses: ./.github/workflows/tests.yml
    with:
      go-version: '1.24.4'
      node-version: '22'

  build:
    needs: test
    uses: ./.github/workflows/build.yml
    with:
      go-version: '1.24.4'
      build-all-platforms: true  # Build all platforms for releases

  build-web:
    needs: build
    uses: ./.github/workflows/build-web.yml
    with:
      node-version: '22'
      pnpm-version: '10.11.0'
      upload-artifacts: true  # Upload artifacts for releases
